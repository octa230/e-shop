{"ast":null,"code":"import _asyncToGenerator from\"/home/octa/e-shop/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/octa/e-shop/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/home/octa/e-shop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/home/octa/e-shop/frontend/node_modules/@babel/runtime/regenerator/index.js\";import axios from'axios';import React,{useContext,useEffect,useReducer}from'react';import{PayPalButtons,usePayPalScriptReducer}from'@paypal/react-paypal-js';import{Helmet}from'react-helmet-async';import{useNavigate,useParams}from'react-router-dom';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import ListGroup from'react-bootstrap/ListGroup';import Card from'react-bootstrap/Card';import{Link}from'react-router-dom';import LoadingBox from'../components/LoadingBox';import MessageBox from'../components/MessageBox';import{Store}from'../Store';import{getError}from'../utils';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function reducer(state,action){switch(action.type){case'FETCH_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true,error:''});case'FETCH_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loading:false,order:action.payload,error:''});case'FETCH_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});case'PAY_REQUEST':return _objectSpread(_objectSpread({},state),{},{loadingPay:true});case'PAY_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loadingPay:false,successPay:true});case'PAY_FAIL':return _objectSpread(_objectSpread({},state),{},{loadingPay:false});case'PAY_RESET':return _objectSpread(_objectSpread({},state),{},{loadingPay:false,successPay:false});default:return state;}}export default function OrderScreen(){var _useContext=useContext(Store),state=_useContext.state;var userInfo=state.userInfo;var params=useParams();var orderId=params.id;var navigate=useNavigate();var _useReducer=useReducer(reducer,{loading:true,order:{},error:'',successPay:false,loadingPay:false}),_useReducer2=_slicedToArray(_useReducer,2),_useReducer2$=_useReducer2[0],loading=_useReducer2$.loading,error=_useReducer2$.error,order=_useReducer2$.order,successPay=_useReducer2$.successPay,loadingPay=_useReducer2$.loadingPay,dispatch=_useReducer2[1];var _usePayPalScriptReduc=usePayPalScriptReducer(),_usePayPalScriptReduc2=_slicedToArray(_usePayPalScriptReduc,2),isPending=_usePayPalScriptReduc2[0].isPending,paypalDispatch=_usePayPalScriptReduc2[1];function createOrder(data,actions){return actions.order.create({purchase_units:[{amount:{value:order.totalPrice}}]}).then(function(orderID){return orderID;});}function onApprove(data,actions){return actions.order.capture().then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(details){var _yield$axios$put,_data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch({type:'PAY_REQUEST'});_context.next=4;return axios.put(\"/api/orders/\".concat(order._id,\"/pay\"),details,{headers:{authorization:\"Bearer \".concat(userInfo.token)}});case 4:_yield$axios$put=_context.sent;_data=_yield$axios$put.data;dispatch({type:'PAY_SUCCESS',payload:_data});toast.success('Order is paid');_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);dispatch({type:'PAY_FAIL',payload:getError(_context.t0)});toast.error(getError(_context.t0));case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function(_x){return _ref.apply(this,arguments);};}());}function onError(err){toast.error(getError(err));}useEffect(function(){var fetchOrder=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch({type:'FETCH_REQUEST'});_context2.next=4;return axios.get(\"/api/orders/\".concat(orderId),{headers:{authorization:\"Bearer \".concat(userInfo.token)}});case 4:_yield$axios$get=_context2.sent;data=_yield$axios$get.data;dispatch({type:'FETCH_SUCCESS',payload:data});_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);dispatch({type:'FETCH_FAIL',payload:getError(_context2.t0)});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function fetchOrder(){return _ref2.apply(this,arguments);};}();if(!userInfo){return navigate('/login');}if(!order._id||successPay||order._id&&order._id!==orderId){fetchOrder();if(successPay){dispatch({type:'PAY_RESET'});}}else{var loadPayPalScript=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _yield$axios$get2,clientId;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/keys/paypal',{headers:{authorization:\"Bearer \".concat(userInfo.token)}});case 2:_yield$axios$get2=_context3.sent;clientId=_yield$axios$get2.data;paypalDispatch({type:'resetOptions',value:{'client-id':clientId,currency:'USD'}});paypalDispatch({type:'setLoadingStatus',value:'pending'});case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function loadPayPalScript(){return _ref3.apply(this,arguments);};}();loadPayPalScript();}},[order,userInfo,orderId,navigate,paypalDispatch,successPay]);return loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsxs(\"title\",{children:[\"Order \",orderId]})}),/*#__PURE__*/_jsxs(\"h1\",{className:\"my-3\",children:[\"Order \",orderId]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"card_title\",children:\"Shipping\"}),/*#__PURE__*/_jsxs(Card.Text,{className:\"card_text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",order.shippingAddress.fullName,\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Address: \"}),\" \",order.shippingAddress.address,\",\",order.shippingAddress.city,\", \",order.shippingAddress.postalCode,\",\",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(MessageBox,{variant:\"success\",children:[\"Delivered at \",order.deliveredAt]}):/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:\"Not Delivered\"})]})}),/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"card_title\",children:\"Payment\"}),/*#__PURE__*/_jsxs(Card.Text,{className:\"card_text\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method:\"}),\" \",order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(MessageBox,{variant:\"success\",children:[\"Paid at \",order.paidAt]}):/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:\"Not Paid\"})]})}),/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"card_title\",children:\"Items\"}),/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:order.orderItems.map(function(item){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{className:\"align-items-center\",children:[/*#__PURE__*/_jsxs(Col,{md:6,children:[/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,className:\"img-fluid rounded img-thumbnail cart_image\"}),' ',/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.slug),children:item.name})]}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsx(\"span\",{children:item.quantity})}),/*#__PURE__*/_jsxs(Col,{md:3,children:[\"$\",item.price]})]})},item._id);})})]})})]}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{className:\"mb-3\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{children:\"Order Summary\"}),/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.itemsPrice.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.shippingPrice.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Tax\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.taxPrice.toFixed(2)]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"strong\",{children:\" Order Total\"})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"$\",order.totalPrice.toFixed(2)]})})]})}),!order.isPaid&&/*#__PURE__*/_jsxs(ListGroup.Item,{children:[isPending?/*#__PURE__*/_jsx(LoadingBox,{}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(PayPalButtons,{createOrder:createOrder,onApprove:onApprove,onError:onError})}),loadingPay&&/*#__PURE__*/_jsx(LoadingBox,{})]})]})]})})})]})]});}","map":{"version":3,"sources":["/home/octa/e-shop/frontend/src/screens/OrderScreen.js"],"names":["axios","React","useContext","useEffect","useReducer","PayPalButtons","usePayPalScriptReducer","Helmet","useNavigate","useParams","Row","Col","ListGroup","Card","Link","LoadingBox","MessageBox","Store","getError","toast","reducer","state","action","type","loading","error","order","payload","loadingPay","successPay","OrderScreen","userInfo","params","orderId","id","navigate","dispatch","isPending","paypalDispatch","createOrder","data","actions","create","purchase_units","amount","value","totalPrice","then","orderID","onApprove","capture","details","put","_id","headers","authorization","token","success","onError","err","fetchOrder","get","loadPayPalScript","clientId","currency","shippingAddress","fullName","address","city","postalCode","country","isDelivered","deliveredAt","paymentMethod","isPaid","paidAt","orderItems","map","item","image","name","slug","quantity","price","itemsPrice","toFixed","shippingPrice","taxPrice"],"mappings":"kcAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,UAAhB,CAA4BC,SAA5B,CAAuCC,UAAvC,KAAyD,OAAzD,CACA,OAASC,aAAT,CAAwBC,sBAAxB,KAAsD,yBAAtD,CACA,OAASC,MAAT,KAAuB,oBAAvB,CACA,OAASC,WAAT,CAAsBC,SAAtB,KAAuC,kBAAvC,CACA,MAAOC,CAAAA,GAAP,KAAgB,qBAAhB,CACA,MAAOC,CAAAA,GAAP,KAAgB,qBAAhB,CACA,MAAOC,CAAAA,SAAP,KAAsB,2BAAtB,CACA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,CACA,OAASC,IAAT,KAAqB,kBAArB,CACA,MAAOC,CAAAA,UAAP,KAAuB,0BAAvB,CACA,MAAOC,CAAAA,UAAP,KAAuB,0BAAvB,CACA,OAASC,KAAT,KAAsB,UAAtB,CACA,OAASC,QAAT,KAAyB,UAAzB,CACA,OAASC,KAAT,KAAsB,gBAAtB,C,wFAEA,QAASC,CAAAA,OAAT,CAAiBC,KAAjB,CAAwBC,MAAxB,CAAgC,CAC9B,OAAQA,MAAM,CAACC,IAAf,EACE,IAAK,eAAL,CACE,sCAAYF,KAAZ,MAAmBG,OAAO,CAAE,IAA5B,CAAkCC,KAAK,CAAE,EAAzC,GACF,IAAK,eAAL,CACE,sCAAYJ,KAAZ,MAAmBG,OAAO,CAAE,KAA5B,CAAmCE,KAAK,CAAEJ,MAAM,CAACK,OAAjD,CAA0DF,KAAK,CAAE,EAAjE,GACF,IAAK,YAAL,CACE,sCAAYJ,KAAZ,MAAmBG,OAAO,CAAE,KAA5B,CAAmCC,KAAK,CAAEH,MAAM,CAACK,OAAjD,GACF,IAAK,aAAL,CACE,sCAAYN,KAAZ,MAAmBO,UAAU,CAAE,IAA/B,GACF,IAAK,aAAL,CACE,sCAAWP,KAAX,MAAkBO,UAAU,CAAE,KAA9B,CAAqCC,UAAU,CAAE,IAAjD,GACF,IAAI,UAAJ,CACE,sCAAYR,KAAZ,MAAmBO,UAAU,CAAE,KAA/B,GACA,IAAK,WAAL,CACA,sCAAWP,KAAX,MAAkBO,UAAU,CAAE,KAA9B,CAAqCC,UAAU,CAAE,KAAjD,GAEF,QACE,MAAOR,CAAAA,KAAP,CAjBJ,CAmBD,CACD,cAAe,SAASS,CAAAA,WAAT,EAAuB,CACpC,gBAAkB5B,UAAU,CAACe,KAAD,CAA5B,CAAQI,KAAR,aAAQA,KAAR,CACA,GAAQU,CAAAA,QAAR,CAAqBV,KAArB,CAAQU,QAAR,CAEA,GAAMC,CAAAA,MAAM,CAAGvB,SAAS,EAAxB,CACA,GAAYwB,CAAAA,OAAZ,CAAwBD,MAAxB,CAAQE,EAAR,CACA,GAAMC,CAAAA,QAAQ,CAAG3B,WAAW,EAA5B,CAEA,gBAAsEJ,UAAU,CAACgB,OAAD,CAAU,CACxFI,OAAO,CAAE,IAD+E,CAExFE,KAAK,CAAE,EAFiF,CAGxFD,KAAK,CAAE,EAHiF,CAIxFI,UAAU,CAAE,KAJ4E,CAKxFD,UAAU,CAAE,KAL4E,CAAV,CAAhF,0EAASJ,OAAT,eAASA,OAAT,CAAkBC,KAAlB,eAAkBA,KAAlB,CAAyBC,KAAzB,eAAyBA,KAAzB,CAAgCG,UAAhC,eAAgCA,UAAhC,CAA4CD,UAA5C,eAA4CA,UAA5C,CAA0DQ,QAA1D,iBAQA,0BAAwC9B,sBAAsB,EAA9D,gEAAQ+B,SAAR,2BAAQA,SAAR,CAAqBC,cAArB,2BAEA,QAASC,CAAAA,WAAT,CAAqBC,IAArB,CAA2BC,OAA3B,CAAmC,CACjC,MAAOA,CAAAA,OAAO,CAACf,KAAR,CACNgB,MADM,CACC,CAACC,cAAc,CAAE,CACvB,CACEC,MAAM,CAAE,CAACC,KAAK,CAAEnB,KAAK,CAACoB,UAAd,CADV,CADuB,CAAjB,CADD,EAORC,IAPQ,CAOH,SAACC,OAAD,CAAa,CACjB,MAAOA,CAAAA,OAAP,CACD,CATQ,CAAP,CAUD,CAED,QAASC,CAAAA,SAAT,CAAmBT,IAAnB,CAAyBC,OAAzB,CAAiC,CAC/B,MAAOA,CAAAA,OAAO,CAACf,KAAR,CAAcwB,OAAd,GAAwBH,IAAxB,0FAA6B,iBAAeI,OAAf,6JAEhCf,QAAQ,CAAC,CAACb,IAAI,CAAE,aAAP,CAAD,CAAR,CAFgC,sBAGTvB,CAAAA,KAAK,CAACoD,GAAN,uBACN1B,KAAK,CAAC2B,GADA,SAErBF,OAFqB,CAGrB,CACEG,OAAO,CAAE,CAACC,aAAa,kBAAYxB,QAAQ,CAACyB,KAArB,CAAd,CADX,CAHqB,CAHS,uCAGxBhB,KAHwB,kBAGxBA,IAHwB,CAUhCJ,QAAQ,CAAC,CAACb,IAAI,CAAE,aAAP,CAAsBI,OAAO,CAAEa,KAA/B,CAAD,CAAR,CACArB,KAAK,CAACsC,OAAN,CAAc,eAAd,EAXgC,iFAchCrB,QAAQ,CAAC,CAACb,IAAI,CAAE,UAAP,CAAmBI,OAAO,CAAET,QAAQ,aAApC,CAAD,CAAR,CACAC,KAAK,CAACM,KAAN,CAAYP,QAAQ,aAApB,EAfgC,qEAA7B,+DAAP,CAkBD,CAED,QAASwC,CAAAA,OAAT,CAAiBC,GAAjB,CAAsB,CACpBxC,KAAK,CAACM,KAAN,CAAYP,QAAQ,CAACyC,GAAD,CAApB,EACD,CAEDxD,SAAS,CAAC,UAAM,CACd,GAAMyD,CAAAA,UAAU,2FAAG,mLAEfxB,QAAQ,CAAC,CAAEb,IAAI,CAAE,eAAR,CAAD,CAAR,CAFe,uBAGQvB,CAAAA,KAAK,CAAC6D,GAAN,uBAAyB5B,OAAzB,EAAoC,CACzDqB,OAAO,CAAE,CAAEC,aAAa,kBAAYxB,QAAQ,CAACyB,KAArB,CAAf,CADgD,CAApC,CAHR,wCAGPhB,IAHO,kBAGPA,IAHO,CAMfJ,QAAQ,CAAC,CAAEb,IAAI,CAAE,eAAR,CAAyBI,OAAO,CAAEa,IAAlC,CAAD,CAAR,CANe,mFAQfJ,QAAQ,CAAC,CAAEb,IAAI,CAAE,YAAR,CAAsBI,OAAO,CAAET,QAAQ,cAAvC,CAAD,CAAR,CARe,sEAAH,kBAAV0C,CAAAA,UAAU,2CAAhB,CAYA,GAAI,CAAC7B,QAAL,CAAe,CACb,MAAOI,CAAAA,QAAQ,CAAC,QAAD,CAAf,CACD,CACD,GAAI,CAACT,KAAK,CAAC2B,GAAP,EAAcxB,UAAd,EAA6BH,KAAK,CAAC2B,GAAN,EAAa3B,KAAK,CAAC2B,GAAN,GAAcpB,OAA5D,CAAsE,CACpE2B,UAAU,GAEV,GAAG/B,UAAH,CAAe,CACbO,QAAQ,CAAC,CAACb,IAAI,CAAE,WAAP,CAAD,CAAR,CACD,CAEF,CAPD,IAOM,CAEJ,GAAMuC,CAAAA,gBAAgB,2FAAG,8LACU9D,CAAAA,KAAK,CAAC6D,GAAN,CAAU,kBAAV,CAA8B,CAC7DP,OAAO,CAAE,CAACC,aAAa,kBAAYxB,QAAQ,CAACyB,KAArB,CAAd,CADoD,CAA9B,CADV,yCACTO,QADS,mBACfvB,IADe,CAIvBF,cAAc,CAAC,CACbf,IAAI,CAAE,cADO,CAEbsB,KAAK,CAAE,CACL,YAAakB,QADR,CAELC,QAAQ,CAAE,KAFL,CAFM,CAAD,CAAd,CAOA1B,cAAc,CAAC,CAACf,IAAI,CAAE,kBAAP,CAA2BsB,KAAK,CAAE,SAAlC,CAAD,CAAd,CAXuB,wDAAH,kBAAhBiB,CAAAA,gBAAgB,2CAAtB,CAcAA,gBAAgB,GACjB,CAGF,CA3CQ,CA2CN,CAACpC,KAAD,CAAQK,QAAR,CAAkBE,OAAlB,CAA2BE,QAA3B,CAAqCG,cAArC,CAAqDT,UAArD,CA3CM,CAAT,CA4CA,MAAOL,CAAAA,OAAO,cACZ,KAAC,UAAD,IADY,CAEVC,KAAK,cACP,KAAC,UAAD,EAAY,OAAO,CAAC,QAApB,UAA8BA,KAA9B,EADO,cAGP,oCACE,KAAC,MAAD,wBACE,kCAAcQ,OAAd,GADF,EADF,cAIE,YAAI,SAAS,CAAC,MAAd,oBAA4BA,OAA5B,GAJF,cAKE,MAAC,GAAD,yBACE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAT,wBACE,KAAC,IAAD,EAAM,SAAS,CAAC,MAAhB,uBACE,MAAC,IAAD,CAAM,IAAN,yBACE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,sBADF,cAEE,MAAC,IAAD,CAAM,IAAN,EAAW,SAAS,CAAC,WAArB,wBACE,iCADF,KAC0BP,KAAK,CAACuC,eAAN,CAAsBC,QADhD,kBAC0D,aAD1D,cAEE,qCAFF,KAE8BxC,KAAK,CAACuC,eAAN,CAAsBE,OAFpD,KAGGzC,KAAK,CAACuC,eAAN,CAAsBG,IAHzB,MAGiC1C,KAAK,CAACuC,eAAN,CAAsBI,UAHvD,KAII3C,KAAK,CAACuC,eAAN,CAAsBK,OAJ1B,GAFF,CAQG5C,KAAK,CAAC6C,WAAN,cACC,MAAC,UAAD,EAAY,OAAO,CAAC,SAApB,2BACgB7C,KAAK,CAAC8C,WADtB,GADD,cAKC,KAAC,UAAD,EAAY,OAAO,CAAC,QAApB,2BAbJ,GADF,EADF,cAmBE,KAAC,IAAD,EAAM,SAAS,CAAC,MAAhB,uBACE,MAAC,IAAD,CAAM,IAAN,yBACE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,qBADF,cAEE,MAAC,IAAD,CAAM,IAAN,EAAW,SAAS,CAAC,WAArB,wBACE,mCADF,KAC4B9C,KAAK,CAAC+C,aADlC,GAFF,CAKG/C,KAAK,CAACgD,MAAN,cACC,MAAC,UAAD,EAAY,OAAO,CAAC,SAApB,sBACWhD,KAAK,CAACiD,MADjB,GADD,cAKC,KAAC,UAAD,EAAY,OAAO,CAAC,QAApB,sBAVJ,GADF,EAnBF,cAmCE,KAAC,IAAD,EAAM,SAAS,CAAC,MAAhB,uBACE,MAAC,IAAD,CAAM,IAAN,yBACE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,YAAtB,mBADF,cAEE,KAAC,SAAD,EAAW,OAAO,CAAC,OAAnB,UACGjD,KAAK,CAACkD,UAAN,CAAiBC,GAAjB,CAAqB,SAACC,IAAD,qBACpB,KAAC,SAAD,CAAW,IAAX,wBACE,MAAC,GAAD,EAAK,SAAS,CAAC,oBAAf,wBACE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAT,wBACE,YACE,GAAG,CAAEA,IAAI,CAACC,KADZ,CAEE,GAAG,CAAED,IAAI,CAACE,IAFZ,CAGE,SAAS,CAAC,4CAHZ,EADF,CAKU,GALV,cAME,KAAC,IAAD,EAAM,EAAE,oBAAcF,IAAI,CAACG,IAAnB,CAAR,UAAoCH,IAAI,CAACE,IAAzC,EANF,GADF,cASE,KAAC,GAAD,EAAK,EAAE,CAAE,CAAT,uBACE,sBAAOF,IAAI,CAACI,QAAZ,EADF,EATF,cAYE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAT,eAAcJ,IAAI,CAACK,KAAnB,GAZF,GADF,EAAqBL,IAAI,CAACzB,GAA1B,CADoB,EAArB,CADH,EAFF,GADF,EAnCF,GADF,cA8DE,KAAC,GAAD,EAAK,EAAE,CAAE,CAAT,uBACE,KAAC,IAAD,EAAM,SAAS,CAAC,MAAhB,uBACE,MAAC,IAAD,CAAM,IAAN,yBACE,KAAC,IAAD,CAAM,KAAN,4BADF,cAEE,MAAC,SAAD,EAAW,OAAO,CAAC,OAAnB,wBACE,KAAC,SAAD,CAAW,IAAX,wBACE,MAAC,GAAD,yBACE,KAAC,GAAD,oBADF,cAEE,MAAC,GAAD,gBAAO3B,KAAK,CAAC0D,UAAN,CAAiBC,OAAjB,CAAyB,CAAzB,CAAP,GAFF,GADF,EADF,cAOE,KAAC,SAAD,CAAW,IAAX,wBACE,MAAC,GAAD,yBACE,KAAC,GAAD,uBADF,cAEE,MAAC,GAAD,gBAAO3D,KAAK,CAAC4D,aAAN,CAAoBD,OAApB,CAA4B,CAA5B,CAAP,GAFF,GADF,EAPF,cAaE,KAAC,SAAD,CAAW,IAAX,wBACE,MAAC,GAAD,yBACE,KAAC,GAAD,kBADF,cAEE,MAAC,GAAD,gBAAO3D,KAAK,CAAC6D,QAAN,CAAeF,OAAf,CAAuB,CAAvB,CAAP,GAFF,GADF,EAbF,cAmBE,KAAC,SAAD,CAAW,IAAX,wBACE,MAAC,GAAD,yBACE,KAAC,GAAD,wBACE,wCADF,EADF,cAIE,KAAC,GAAD,wBACE,8BAAU3D,KAAK,CAACoB,UAAN,CAAiBuC,OAAjB,CAAyB,CAAzB,CAAV,GADF,EAJF,GADF,EAnBF,CA6BG,CAAC3D,KAAK,CAACgD,MAAP,eACC,MAAC,SAAD,CAAW,IAAX,YACGrC,SAAS,cACR,KAAC,UAAD,IADQ,cAGR,kCACE,KAAC,aAAD,EACE,WAAW,CAAIE,WADjB,CAEE,SAAS,CAAIU,SAFf,CAGE,OAAO,CAAGS,OAHZ,EADF,EAJJ,CAYG9B,UAAU,eAAI,KAAC,UAAD,IAZjB,GA9BJ,GAFF,GADF,EADF,EA9DF,GALF,GALF,CAgID","sourcesContent":["import axios from 'axios';\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport { PayPalButtons, usePayPalScriptReducer } from '@paypal/react-paypal-js';\nimport { Helmet } from 'react-helmet-async';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport Card from 'react-bootstrap/Card';\nimport { Link } from 'react-router-dom';\nimport LoadingBox from '../components/LoadingBox';\nimport MessageBox from '../components/MessageBox';\nimport { Store } from '../Store';\nimport { getError } from '../utils';\nimport { toast } from 'react-toastify';\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'FETCH_REQUEST':\n      return { ...state, loading: true, error: '' };\n    case 'FETCH_SUCCESS':\n      return { ...state, loading: false, order: action.payload, error: '' };\n    case 'FETCH_FAIL':\n      return { ...state, loading: false, error: action.payload };\n    case 'PAY_REQUEST':\n      return { ...state, loadingPay: true };\n    case 'PAY_SUCCESS': \n      return {...state, loadingPay: false, successPay: true }\n    case'PAY_FAIL':\n      return { ...state, loadingPay: false };\n      case 'PAY_RESET': \n      return {...state, loadingPay: false, successPay: false };\n\n    default:\n      return state;\n  }\n}\nexport default function OrderScreen() {\n  const { state } = useContext(Store);\n  const { userInfo } = state;\n\n  const params = useParams();\n  const { id: orderId } = params;\n  const navigate = useNavigate();\n\n  const [{ loading, error, order, successPay, loadingPay }, dispatch] = useReducer(reducer, {\n    loading: true,\n    order: {},\n    error: '',\n    successPay: false, \n    loadingPay: false,\n  });\n\n  const [{isPending }, paypalDispatch ] = usePayPalScriptReducer();\n\n  function createOrder(data, actions){\n    return actions.order\n    .create({purchase_units: [\n      {\n        amount: {value: order.totalPrice },\n      },\n    ],\n  })\n  .then((orderID) => {\n    return orderID;\n  });\n  }\n\n  function onApprove(data, actions){\n    return actions.order.capture().then(async function(details){\n      try{\n        dispatch({type: 'PAY_REQUEST'});\n        const { data } = await axios.put(\n          `/api/orders/${order._id}/pay`,\n          details,\n          {\n            headers: {authorization: `Bearer ${userInfo.token}`},\n          }\n        );\n        dispatch({type: 'PAY_SUCCESS', payload: data });\n        toast.success('Order is paid');\n\n      }catch (err) {\n        dispatch({type: 'PAY_FAIL', payload: getError(err) });\n        toast.error(getError(err))\n      }\n    })\n  }\n\n  function onError(err) {\n    toast.error(getError(err));\n  }\n\n  useEffect(() => {\n    const fetchOrder = async () => {\n      try {\n        dispatch({ type: 'FETCH_REQUEST' });\n        const { data } = await axios.get(`/api/orders/${orderId}`, {\n          headers: { authorization: `Bearer ${userInfo.token}` },\n        });\n        dispatch({ type: 'FETCH_SUCCESS', payload: data });\n      } catch (err) {\n        dispatch({ type: 'FETCH_FAIL', payload: getError(err) });\n      }\n    };\n\n    if (!userInfo) {\n      return navigate('/login');\n    }\n    if (!order._id || successPay || (order._id && order._id !== orderId)) {\n      fetchOrder();\n\n      if(successPay) {\n        dispatch({type: 'PAY_RESET' });\n      }\n\n    }else {\n\n      const loadPayPalScript = async () => {\n        const { data: clientId } = await axios.get('/api/keys/paypal', {\n          headers: {authorization: `Bearer ${userInfo.token}`},\n        });\n        paypalDispatch({\n          type: 'resetOptions',\n          value: {\n            'client-id': clientId,\n            currency: 'USD',\n          },\n        });\n        paypalDispatch({type: 'setLoadingStatus', value: 'pending'});\n      }\n\n      loadPayPalScript();\n    }\n    \n\n  }, [order, userInfo, orderId, navigate, paypalDispatch, successPay]);\n  return loading ? (\n    <LoadingBox></LoadingBox>\n  ) : error ? (\n    <MessageBox variant=\"danger\">{error}</MessageBox>\n  ) : (\n    <div>\n      <Helmet>\n        <title>Order {orderId}</title>\n      </Helmet>\n      <h1 className=\"my-3\">Order {orderId}</h1>\n      <Row>\n        <Col md={8}>\n          <Card className=\"mb-3\">\n            <Card.Body>\n              <Card.Title className='card_title'>Shipping</Card.Title>\n              <Card.Text className='card_text'>\n                <strong>Name:</strong> {order.shippingAddress.fullName} <br />\n                <strong>Address: </strong> {order.shippingAddress.address},\n                {order.shippingAddress.city}, {order.shippingAddress.postalCode}\n                ,{order.shippingAddress.country}\n              </Card.Text>\n              {order.isDelivered ? (\n                <MessageBox variant=\"success\">\n                  Delivered at {order.deliveredAt}\n                </MessageBox>\n              ) : (\n                <MessageBox variant=\"danger\">Not Delivered</MessageBox>\n              )}\n            </Card.Body>\n          </Card>\n          <Card className=\"mb-3\">\n            <Card.Body>\n              <Card.Title className='card_title'>Payment</Card.Title>\n              <Card.Text className='card_text'>\n                <strong>Method:</strong> {order.paymentMethod}\n              </Card.Text>\n              {order.isPaid ? (\n                <MessageBox variant=\"success\">\n                  Paid at {order.paidAt}\n                </MessageBox>\n              ) : (\n                <MessageBox variant=\"danger\">Not Paid</MessageBox>\n              )}\n            </Card.Body>\n          </Card>\n\n          <Card className=\"mb-3\">\n            <Card.Body>\n              <Card.Title className='card_title'>Items</Card.Title>\n              <ListGroup variant=\"flush\">\n                {order.orderItems.map((item) => (\n                  <ListGroup.Item key={item._id}>\n                    <Row className=\"align-items-center\">\n                      <Col md={6}>\n                        <img\n                          src={item.image}\n                          alt={item.name}\n                          className=\"img-fluid rounded img-thumbnail cart_image\"\n                        ></img>{' '}\n                        <Link to={`/product/${item.slug}`}>{item.name}</Link>\n                      </Col>\n                      <Col md={3}>\n                        <span>{item.quantity}</span>\n                      </Col>\n                      <Col md={3}>${item.price}</Col>\n                    </Row>\n                  </ListGroup.Item>\n                ))}\n              </ListGroup>\n            </Card.Body>\n          </Card>\n        </Col>\n        <Col md={4}>\n          <Card className=\"mb-3\">\n            <Card.Body>\n              <Card.Title>Order Summary</Card.Title>\n              <ListGroup variant=\"flush\">\n                <ListGroup.Item>\n                  <Row>\n                    <Col>Items</Col>\n                    <Col>${order.itemsPrice.toFixed(2)}</Col>\n                  </Row>\n                </ListGroup.Item>\n                <ListGroup.Item>\n                  <Row>\n                    <Col>Shipping</Col>\n                    <Col>${order.shippingPrice.toFixed(2)}</Col>\n                  </Row>\n                </ListGroup.Item>\n                <ListGroup.Item>\n                  <Row>\n                    <Col>Tax</Col>\n                    <Col>${order.taxPrice.toFixed(2)}</Col>\n                  </Row>\n                </ListGroup.Item>\n                <ListGroup.Item>\n                  <Row>\n                    <Col>\n                      <strong> Order Total</strong>\n                    </Col>\n                    <Col>\n                      <strong>${order.totalPrice.toFixed(2)}</strong>\n                    </Col>\n                  </Row>\n                </ListGroup.Item>\n                {!order.isPaid && (\n                  <ListGroup.Item>\n                    {isPending ? (\n                      <LoadingBox />\n                    ):(\n                      <div>\n                        <PayPalButtons\n                          createOrder = {createOrder}\n                          onApprove = {onApprove}\n                          onError= {onError}>\n                          </PayPalButtons>\n                      </div>\n                    )}\n                    {loadingPay && <LoadingBox></LoadingBox>}\n                  </ListGroup.Item>\n                )}\n              </ListGroup>\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}